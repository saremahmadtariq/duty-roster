<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - South East Pharmacy</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-4xl font-bold">üìä Reports</h1>
            <a href="home.html" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg transition-colors">‚Üê Back</a>
        </div>

        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold mb-4">Generate Report</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Report Type:</label>
                        <select class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                            <option>Duty Summary</option>
                            <option>Attendance Report</option>
                            <option>Monthly Overview</option>
                            <option>Staff Performance</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Date Range:</label>
                        <div class="flex gap-2">
                            <input type="date" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                            <input type="date" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                        </div>
                    </div>
                    <button onclick="generateReport()" class="w-full bg-purple-600 hover:bg-purple-700 py-3 rounded font-semibold transition-colors">Generate Report</button>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold mb-4">Quick Stats</h3>
                <div class="space-y-4">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Total Staff:</span>
                        <span class="font-bold">8</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Active Today:</span>
                        <span class="font-bold text-green-400">6</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">On Leave:</span>
                        <span class="font-bold text-yellow-400">1</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Overtime Hours:</span>
                        <span class="font-bold text-blue-400">24</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6">
            <h3 class="text-xl font-bold mb-4">Recent Reports</h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="text-left py-3">Report Name</th>
                            <th class="text-left py-3">Type</th>
                            <th class="text-left py-3">Generated</th>
                            <th class="text-left py-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    <tbody id="reportsTableBody">
                        <!-- Reports will be populated dynamically -->
                    </tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let reportsData = [
            { name: 'December Duty Summary', type: 'Duty', generated: '2024-01-01', id: 'duty_dec_2024' },
            { name: 'Staff Attendance Nov', type: 'Attendance', generated: '2023-12-01', id: 'att_nov_2023' },
            { name: 'Monthly Overview Oct', type: 'Overview', generated: '2023-11-01', id: 'overview_oct_2023' }
        ];

        function renderReports() {
            const tbody = document.getElementById('reportsTableBody');
            tbody.innerHTML = '';

            reportsData.forEach((report, index) => {
                const typeColors = {
                    'Duty': 'bg-blue-600',
                    'Attendance': 'bg-purple-600',
                    'Overview': 'bg-yellow-600',
                    'Performance': 'bg-green-600'
                };

                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700';
                row.innerHTML = `
                    <td class="py-3">${report.name}</td>
                    <td class="py-3"><span class="${typeColors[report.type]} px-2 py-1 rounded text-xs">${report.type}</span></td>
                    <td class="py-3">${report.generated}</td>
                    <td class="py-3">
                        <button onclick="downloadReport('${report.id}')" class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm mr-2">Download</button>
                        <button onclick="deleteReport(${index})" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function generateReport() {
            const reportType = document.querySelector('select').value;
            const startDate = document.querySelectorAll('input[type="date"]')[0].value;
            const endDate = document.querySelectorAll('input[type="date"]')[1].value;

            if (!startDate || !endDate) {
                alert('Please select both start and end dates');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                alert('Start date cannot be after end date');
                return;
            }

            // Generate report data based on type
            let reportData = {};
            const reportId = `${reportType.toLowerCase()}_${Date.now()}`;
            const reportName = `${reportType} Report (${startDate} to ${endDate})`;

            switch(reportType) {
                case 'Duty Summary':
                    reportData = generateDutySummary(startDate, endDate);
                    break;
                case 'Attendance Report':
                    reportData = generateAttendanceReport(startDate, endDate);
                    break;
                case 'Monthly Overview':
                    reportData = generateMonthlyOverview(startDate, endDate);
                    break;
                case 'Staff Performance':
                    reportData = generatePerformanceReport(startDate, endDate);
                    break;
            }

            // Add to reports list
            const newReport = {
                name: reportName,
                type: reportType,
                generated: new Date().toISOString().split('T')[0],
                id: reportId,
                data: reportData
            };

            reportsData.unshift(newReport);
            saveReportsData();
            renderReports();
            updateQuickStats();

            alert(`${reportType} generated successfully!`);
        }

        function generateDutySummary(startDate, endDate) {
            const staff = ['Dr.Sharafat', 'Sarem', 'Sajid', 'Aneeq', 'Waqas', 'Aqib', 'Illyas', 'Zohaib'];
            const summary = {};

            staff.forEach(member => {
                summary[member] = {
                    totalDays: Math.floor(Math.random() * 20) + 10,
                    morningShifts: Math.floor(Math.random() * 10) + 5,
                    eveningShifts: Math.floor(Math.random() * 10) + 5,
                    nightShifts: Math.floor(Math.random() * 5) + 2,
                    offDays: Math.floor(Math.random() * 8) + 2,
                    overtime: Math.floor(Math.random() * 15) + 5
                };
            });

            return summary;
        }

        function generateAttendanceReport(startDate, endDate) {
            const staff = ['Dr.Sharafat', 'Sarem', 'Sajid', 'Aneeq', 'Waqas', 'Aqib', 'Illyas', 'Zohaib'];
            const attendance = {};

            staff.forEach(member => {
                attendance[member] = {
                    present: Math.floor(Math.random() * 25) + 20,
                    absent: Math.floor(Math.random() * 3) + 1,
                    late: Math.floor(Math.random() * 5) + 1,
                    attendanceRate: (Math.random() * 10 + 90).toFixed(1) + '%'
                };
            });

            return attendance;
        }

        function generateMonthlyOverview(startDate, endDate) {
            return {
                totalWorkingDays: 30,
                totalStaff: 8,
                averageAttendance: '94.5%',
                totalOvertimeHours: 156,
                mostActiveStaff: 'Dr.Sharafat',
                leastAbsences: 'Sarem',
                shiftDistribution: {
                    morning: 35,
                    evening: 32,
                    night: 18,
                    overtime: 15
                }
            };
        }

        function generatePerformanceReport(startDate, endDate) {
            const staff = ['Dr.Sharafat', 'Sarem', 'Sajid', 'Aneeq', 'Waqas', 'Aqib', 'Illyas', 'Zohaib'];
            const performance = {};

            staff.forEach(member => {
                performance[member] = {
                    efficiency: (Math.random() * 20 + 80).toFixed(1) + '%',
                    punctuality: (Math.random() * 15 + 85).toFixed(1) + '%',
                    reliability: (Math.random() * 10 + 90).toFixed(1) + '%',
                    overallScore: (Math.random() * 15 + 85).toFixed(1) + '%'
                };
            });

            return performance;
        }

        function downloadReport(reportId) {
            const report = reportsData.find(r => r.id === reportId);
            if (!report) {
                alert('Report not found');
                return;
            }

            // Create CSV content
            let csvContent = `Report: ${report.name}\nGenerated: ${report.generated}\n\n`;
            
            if (report.data) {
                if (typeof report.data === 'object') {
                    Object.keys(report.data).forEach(key => {
                        csvContent += `${key}: ${JSON.stringify(report.data[key])}\n`;
                    });
                }
            }

            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${report.name.replace(/\s+/g, '_')}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function deleteReport(index) {
            if (confirm('Are you sure you want to delete this report?')) {
                reportsData.splice(index, 1);
                saveReportsData();
                renderReports();
                updateQuickStats();
            }
        }

        function updateQuickStats() {
            // Update with real data
            const stats = {
                totalStaff: 8,
                activeToday: Math.floor(Math.random() * 3) + 6,
                onLeave: Math.floor(Math.random() * 2) + 1,
                overtimeHours: Math.floor(Math.random() * 20) + 20
            };

            document.querySelector('.grid .bg-gray-800:nth-child(1) .text-3xl').textContent = stats.totalStaff;
            document.querySelector('.grid .bg-gray-800:nth-child(2) .text-3xl').textContent = stats.activeToday;
            document.querySelector('.grid .bg-gray-800:nth-child(3) .text-3xl').textContent = stats.onLeave;
            document.querySelector('.grid .bg-gray-800:nth-child(4) .text-3xl').textContent = stats.overtimeHours;
        }

        function saveReportsData() {
            localStorage.setItem('reportsData', JSON.stringify(reportsData));
        }

        function loadReportsData() {
            const saved = localStorage.getItem('reportsData');
            if (saved) {
                reportsData = JSON.parse(saved);
            }
        }

        // Initialize
        loadReportsData();
        renderReports();
        updateQuickStats();

        // Set default dates
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        document.querySelectorAll('input[type="date"]')[0].value = firstDay.toISOString().split('T')[0];
        document.querySelectorAll('input[type="date"]')[1].value = today.toISOString().split('T')[0];
    </script>
</body>
</html>