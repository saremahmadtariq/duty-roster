<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daily Closing Form - South East Pharmacy</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-4xl font-bold">üí∞ Daily Closing Form</h1>
        <div class="flex gap-4">
          <button onclick="showPreviousClosings()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">üìÖ View Previous</button>
          <a href="home.html" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg transition-colors">‚Üê Back</a>
        </div>
      </div>

      <div class="grid lg:grid-cols-3 gap-6">
        <!-- Date & Time Section -->
        <div class="bg-gray-800 rounded-lg p-6">
          <h3 class="text-xl font-bold mb-4">Date & Time</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium mb-2">DATE:</label>
              <input type="date" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">TIME:</label>
              <input type="time" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white" />
            </div>
          </div>
        </div>

        <!-- Cash Count Section -->
        <div class="bg-gray-800 rounded-lg p-6">
          <h3 class="text-xl font-bold mb-4">CASH</h3>
          <div class="space-y-3">
            <div class="grid grid-cols-3 gap-2 text-sm">
              <span class="font-medium">Note Type</span>
              <span class="font-medium">Number of notes</span>
              <span class="font-medium">Amount</span>
            </div>

            <div class="grid grid-cols-3 gap-2 items-center">
              <span>Change</span>
              <input type="number" value="190" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm" onchange="updateChange(this)" />
              <span id="change-amount">190</span>
            </div>

            <div class="grid grid-cols-3 gap-2 items-center">
              <span>Five hundred</span>
              <input type="number" value="1" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm" onchange="calculateAmount(this, 500)" />
              <span id="fivehundred-amount">500</span>
            </div>

            <div class="grid grid-cols-3 gap-2 items-center">
              <span>Thousand</span>
              <input type="number" value="1" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm" onchange="calculateAmount(this, 1000)" />
              <span id="thousand-amount">1000</span>
            </div>

            <div class="grid grid-cols-3 gap-2 items-center">
              <span>Five Thousand</span>
              <input type="number" value="45" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm" onchange="calculateAmount(this, 5000)" />
              <span id="fivethousand-amount">225000</span>
            </div>

            <div class="grid grid-cols-3 gap-2 items-center">
              <span>Bills</span>
              <input type="number" value="5000" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm" onchange="updateBills(this)" />
              <span id="bills-amount">5000</span>
            </div>

            <div class="border-t border-gray-600 pt-3 mt-3">
              <div class="flex justify-between font-bold">
                <span>Total Cash</span>
                <span id="total-cash">231690</span>
              </div>
            </div>

            <div class="flex justify-between">
              <span>Income vs Expense Difference</span>
              <span id="income-expense-difference">231469</span>
            </div>
            
            <div class="flex justify-between">
              <span>Cash Difference</span>
              <span id="cash-difference">221</span>
            </div>
          </div>
        </div>

        <!-- Income & Expenses Section -->
        <div class="bg-gray-800 rounded-lg p-6">
          <h3 class="text-xl font-bold mb-4">Product</h3>
          <div class="space-y-4">
            <div>
              <h4 class="font-semibold text-green-400 mb-2">INCOME</h4>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span>Previous day cash</span>
                  <input type="number" value="238540" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm w-20" oninput="calculateTotals()" />
                </div>
                <div class="flex justify-between">
                  <span>Credit Sale</span>
                  <input type="number" value="207307" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm w-20" oninput="calculateTotals()" />
                </div>
                <div class="flex justify-between">
                  <span>Cash sale</span>
                  <input type="number" value="255186" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm w-20" oninput="calculateTotals()" />
                </div>
                <div class="flex justify-between">
                  <span>Credit Clear</span>
                  <input type="number" value="98111" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm w-20" oninput="calculateTotals()" />
                </div>
                <div class="flex justify-between font-bold border-t border-gray-600 pt-2">
                  <span>SUM</span>
                  <span id="income-sum">591837</span>
                </div>
              </div>
            </div>

            <div>
              <h4 class="font-semibold text-red-400 mb-2">Expense</h4>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span>Purchase</span>
                  <input type="number" value="285868" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm w-20" oninput="calculateTotals()" />
                </div>
                <div class="flex justify-between">
                  <span>24hrs Cc</span>
                  <input type="number" value="74500" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm w-20" oninput="calculateTotals()" />
                </div>
                <div class="flex justify-between">
                  <span>Online Payment</span>
                  <input type="number" value="0" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm w-20" oninput="calculateTotals()" />
                </div>
                <div class="flex justify-between font-bold border-t border-gray-600 pt-2">
                  <span>SUM</span>
                  <span id="expense-sum">360368</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-8 text-center space-x-4">
        <button onclick="calculateTotals()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold transition-colors">Calculate Totals</button>
        <button onclick="saveClosingForm()" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg font-semibold transition-colors">Save Closing Form</button>
        <button onclick="printForm()" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-semibold transition-colors">Print Form</button>
      </div>
    </div>

    <!-- Previous Closings Modal -->
    <div id="previousClosingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
      <div class="bg-gray-800 rounded-lg p-8 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">Previous Daily Closings</h2>
          <button onclick="closePreviousClosings()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
        </div>
        
        <div id="previousClosingsList" class="space-y-4">
          <!-- Previous closings will be populated here -->
        </div>
        
        <div class="mt-6 text-center">
          <button onclick="closePreviousClosings()" class="bg-gray-600 hover:bg-gray-700 px-6 py-3 rounded-lg font-semibold transition-colors">Close</button>
        </div>
      </div>
    </div>

    <script>
      function calculateAmount(input, denomination) {
        const amount = input.value * denomination;
        const amountId = input.parentElement.querySelector("span:last-child").id;
        document.getElementById(amountId).textContent = amount;
        calculateTotalCash();
      }

      function updateBills(input) {
        document.getElementById("bills-amount").textContent = input.value;
        calculateTotalCash();
      }

      function updateChange(input) {
        document.getElementById("change-amount").textContent = input.value;
        calculateTotalCash();
      }

      function calculateTotalCash() {
        const amounts = [
          parseInt(document.getElementById("change-amount").textContent),
          parseInt(document.getElementById("fivehundred-amount").textContent),
          parseInt(document.getElementById("thousand-amount").textContent),
          parseInt(document.getElementById("fivethousand-amount").textContent),
          parseInt(document.getElementById("bills-amount").textContent),
        ];

        const total = amounts.reduce((sum, amount) => sum + amount, 0);
        document.getElementById("total-cash").textContent = total;
      }

      function calculateTotals() {
        // Calculate income sum - get all income inputs except Credit Sale (index 1)
        const incomeSection = document.querySelector('.text-green-400').parentElement;
        const incomeInputs = incomeSection.querySelectorAll('input[type="number"]');
        let incomeSum = 0;
        incomeInputs.forEach((input, index) => {
          if (index !== 1) { // Skip Credit Sale (second input)
            incomeSum += parseFloat(input.value) || 0;
          }
        });
        document.getElementById("income-sum").textContent = incomeSum;

        // Calculate expense sum - get all expense inputs
        const expenseSection = document.querySelector('.text-red-400').parentElement;
        const expenseInputs = expenseSection.querySelectorAll('input[type="number"]');
        let expenseSum = 0;
        expenseInputs.forEach((input) => {
          expenseSum += parseFloat(input.value) || 0;
        });
        document.getElementById("expense-sum").textContent = expenseSum;

        // Calculate income vs expense difference
        const incomeExpenseDiff = incomeSum - expenseSum;
        document.getElementById("income-expense-difference").textContent = incomeExpenseDiff;

        // Calculate cash difference
        const totalCash = parseInt(document.getElementById("total-cash").textContent);
        const cashDifference = totalCash - incomeExpenseDiff;
        document.getElementById("cash-difference").textContent = cashDifference;

        // Update cash difference color - red if negative
        const cashDiffElement = document.getElementById("cash-difference");
        if (cashDifference < 0) {
          cashDiffElement.className = "text-red-400 font-bold";
        } else {
          cashDiffElement.className = "text-white";
        }
      }

      function saveClosingForm() {
        const formData = {
          date: document.querySelector('input[type="date"]').value,
          time: document.querySelector('input[type="time"]').value,
          cash: {
            ten: { notes: document.querySelector('input[onchange*="10"]').value, amount: document.getElementById("ten-amount").textContent },
            twenty: { notes: document.querySelector('input[onchange*="20"]').value, amount: document.getElementById("twenty-amount").textContent },
            fifty: { notes: document.querySelector('input[onchange*="50"]').value, amount: document.getElementById("fifty-amount").textContent },
            hundred: { notes: document.querySelector('input[onchange*="100"]').value, amount: document.getElementById("hundred-amount").textContent },
            fiveHundred: { notes: document.querySelector('input[onchange*="500"]').value, amount: document.getElementById("fivehundred-amount").textContent },
            thousand: { notes: document.querySelector('input[onchange*="1000"]').value, amount: document.getElementById("thousand-amount").textContent },
            fiveThousand: { notes: document.querySelector('input[onchange*="5000"]').value, amount: document.getElementById("fivethousand-amount").textContent },
            bills: document.getElementById("bills-amount").textContent,
            total: document.getElementById("total-cash").textContent,
            difference: document.getElementById("cash-difference").textContent,
          },
          income: {
            previousDayCash: document.querySelectorAll(".space-y-2:first-of-type input")[0].value,
            creditSale: document.querySelectorAll(".space-y-2:first-of-type input")[1].value,
            cashSale: document.querySelectorAll(".space-y-2:first-of-type input")[2].value,
            creditClear: document.querySelectorAll(".space-y-2:first-of-type input")[3].value,
            sum: document.getElementById("income-sum").textContent,
          },
          expense: {
            purchase: document.querySelectorAll(".space-y-2:last-of-type input")[0].value,
            cc24hrs: document.querySelectorAll(".space-y-2:last-of-type input")[1].value,
            onlinePayment: document.querySelectorAll(".space-y-2:last-of-type input")[2].value,
            sum: document.getElementById("expense-sum").textContent,
          },
          timestamp: new Date().toISOString(),
        };

        // Save to localStorage
        const savedForms = JSON.parse(localStorage.getItem("closingForms") || "[]");
        savedForms.unshift(formData);

        // Keep only last 30 forms
        if (savedForms.length > 30) {
          savedForms.splice(30);
        }

        localStorage.setItem("closingForms", JSON.stringify(savedForms));
        alert("Closing form saved successfully!");
      }

      function printForm() {
        window.print();
      }

      function showPreviousClosings() {
        const savedForms = JSON.parse(localStorage.getItem('closingForms') || '[]');
        const modal = document.getElementById('previousClosingsModal');
        const list = document.getElementById('previousClosingsList');
        
        if (savedForms.length === 0) {
          list.innerHTML = '<div class="text-center text-gray-400 py-8">No previous closings found</div>';
        } else {
          list.innerHTML = savedForms.map((form, index) => {
            const totalCash = form.cash ? parseInt(form.cash.total) : 0;
            const incomeSum = form.income ? parseInt(form.income.sum) : 0;
            const expenseSum = form.expense ? parseInt(form.expense.sum) : 0;
            const incomeExpenseDiff = incomeSum - expenseSum;
            const cashDifference = totalCash - incomeExpenseDiff;
            const diffColor = cashDifference > 0 ? 'text-green-400' : cashDifference < 0 ? 'text-red-400' : 'text-white';
            const diffSign = cashDifference > 0 ? '+' : '';
            
            return `
            <div class="bg-gray-700 rounded-lg p-6 border border-gray-600">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <h3 class="text-lg font-semibold">${form.date || 'No Date'}</h3>
                  <p class="text-gray-400 text-sm">${form.time || 'No Time'} - ${new Date(form.timestamp).toLocaleDateString()}</p>
                </div>
                <div class="text-right">
                  <div class="text-2xl font-bold ${diffColor}">
                    ${diffSign}${cashDifference}
                  </div>
                  <div class="text-sm text-gray-400">Cash Difference</div>
                </div>
              </div>
              
              <div class="grid md:grid-cols-5 gap-4 text-sm">
                <div>
                  <h4 class="font-semibold text-blue-400 mb-2">Total Cash</h4>
                  <div class="text-lg font-bold">${totalCash}</div>
                </div>
                <div>
                  <h4 class="font-semibold text-green-400 mb-2">Income</h4>
                  <div class="text-lg font-bold">${incomeSum}</div>
                </div>
                <div>
                  <h4 class="font-semibold text-red-400 mb-2">Expense</h4>
                  <div class="text-lg font-bold">${expenseSum}</div>
                </div>
                <div>
                  <h4 class="font-semibold text-yellow-400 mb-2">Income - Expense</h4>
                  <div class="text-lg font-bold">${incomeExpenseDiff}</div>
                </div>
                <div>
                  <h4 class="font-semibold text-purple-400 mb-2">Cash Difference</h4>
                  <div class="text-lg font-bold ${diffColor}">${diffSign}${cashDifference}</div>
                </div>
              </div>
              
              <div class="mt-4 flex gap-2">
                <button onclick="deleteClosingForm(${index})" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm transition-colors">Delete</button>
              </div>
            </div>
            `;
          }).join('');
        }
        
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
      
      function closePreviousClosings() {
        document.getElementById('previousClosingsModal').classList.add('hidden');
        document.getElementById('previousClosingsModal').classList.remove('flex');
      }
      
      function deleteClosingForm(index) {
        if (confirm('Are you sure you want to delete this closing form?')) {
          const savedForms = JSON.parse(localStorage.getItem('closingForms') || '[]');
          savedForms.splice(index, 1);
          localStorage.setItem('closingForms', JSON.stringify(savedForms));
          showPreviousClosings();
        }
      }

      // Set current date and time
      const now = new Date();
      document.querySelector('input[type="date"]').value = now.toISOString().split("T")[0];
      document.querySelector('input[type="time"]').value = now.toTimeString().slice(0, 5);

      // Add event listeners to income and expense inputs
      document.addEventListener('DOMContentLoaded', function() {
        const incomeSection = document.querySelector('.text-green-400').parentElement;
        const expenseSection = document.querySelector('.text-red-400').parentElement;
        
        incomeSection.querySelectorAll('input[type="number"]').forEach(input => {
          input.addEventListener('input', calculateTotals);
        });
        
        expenseSection.querySelectorAll('input[type="number"]').forEach(input => {
          input.addEventListener('input', calculateTotals);
        });
      });

      // Initialize calculations
      calculateTotalCash();
      calculateTotals();
    </script>
  </body>
</html>